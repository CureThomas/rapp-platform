<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>RAPP Platform Wiki: A-full-RAPP-Platform-service-creation-example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="RAPP_logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">RAPP Platform Wiki
   &#160;<span id="projectnumber">v0.6.0</span>
   </div>
   <div id="projectbrief">RAPP Platform is a collection of ROS nodes and back-end processes that aim to deliver ready-to-use generic services to robots</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md_rapp-platform_8wiki_A-full-RAPP-Platform-service-creation-example.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">A-full-RAPP-Platform-service-creation-example </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In this example, a basic guide will be presented that will cover the basics of creating an example RAPP Platform service. We assume that you have successfully installed the RAPP Platform and run the tests, if not please see our installation guide located at</p>
<p><a href="https://github.com/rapp-project/rapp-platform/wiki/How-can-I-set-up-the-RAPP-Platform-in-my-PC%3F">https://github.com/rapp-project/rapp-platform/wiki/How-can-I-set-up-the-RAPP-Platform-in-my-PC%3F</a></p>
<p>It is addressed to the novice user and as such, experienced users may find it too detailed or need to skip over some sections. This tutorial assumes some basic ROS knowledge. Users not familiar with ROS are advised to first complete relevant ROS tutorials that can be found at</p>
<p><a href="http://wiki.ros.org/ROS/Tutorials">http://wiki.ros.org/ROS/Tutorials</a></p>
<p>By the end of the tutorial you should be able to call the service itself and obtain meaningful results. What you will learn:</p>
<ul>
<li>How to create a ROS service in the RAPP Platform, how to launch it and how to call it and obtain its response.</li>
<li>How to create a HOP service for the ROS service that you created. The HOP service will be exposed on the network and will allow you to call the service over an http web request.</li>
</ul>
<h2>Section 1: Creating a ROS RAPP Platform example service</h2>
<p>In this section we will cover how to create a basic ROS RAPP Platform service. Let us assume that the service we should to create takes as input two integer number, adds them together and returns the result.</p>
<h3>Create a ROS Node</h3>
<p>The first thing to do is to create a new ROS Node which will be responsible for the service we want to implement. In order to create a new ROS node, navigate within the rapp-platform directory and create a new package:</p>
<p>```bash $ cd ~/rapp_platform/rapp-platform-catkin-ws/src/rapp-platform/ $ catkin_create_pkg rapp_example_service std_msgs rospy rapp_platform_ros_communications ```</p>
<p>This command creates a new package named rapp_example_service and adds the its dependencies upon the std_msgs, rospy and rapp_platform_ros_communications packages. You can now navigate within the newly created package, and create a directory named cfg:</p>
<p>```bash $ cd ~/rapp_platform/rapp-platform-catkin-ws/src/rapp-platform/rapp_example_service/ $ mkdir cfg $ cd cfg $ touch rapp_example_service_params.yaml $ echo 'rapp_example_service_topic: /rapp/rapp_example_service/add_two_integers' &gt;&gt; rapp_example_service_params.yaml ```</p>
<p>We declared was the name of the service within the .yaml file. Now we will navigate back into the rapp_example_service package and create the launch dir.</p>
<p>```bash $ cd ~/rapp_platform/rapp-platform-catkin-ws/src/rapp-platform/rapp_example_service $ mkdir launch $ cd launch $ touch rapp_example_service.launch ```</p>
<p>The content of <code>rapp_example_service.launch</code> follows:</p>
<p>```xml &lt;launch&gt; &lt;node name="rapp_example_service_node" pkg="rapp_example_service" type="rapp_example_service_main.py" output="screen"&gt; &lt;rosparam file="$(find rapp_example_service)/cfg/rapp_example_service_params.yaml" command="load"&gt; &lt;/launch&gt; ```</p>
<p>This file declares the launcher of the service.</p>
<p>Now, we will create the source code files according to the coding standards of the RAPP project.</p>
<p>```bash $ cd ~/rapp_platform/rapp-platform-catkin-ws/src/rapp-platform/rapp_example_service/src $ touch rapp_example_service_main.py ```</p>
<p>The content of <code>rapp_example_service_main.py</code> follows</p>
<p>```python #!/usr/bin/env python</p>
<p>import rospy from rapp_example_service import ExampleService</p>
<p>if <b>name</b> == "__main__": rospy.init_node('ExampleService') ExampleServicesNode = ExampleService() rospy.spin() ```</p>
<p>We have declared the main function of the ROS node and launched the ROS node with the rospy.spin() command. Now we will create the <code>rapp_example_service.py</code> below:</p>
<p>```bash $ cd ~/rapp_platform/rapp-platform-catkin-ws/src/rapp-platform/rapp_example_service/src $ touch rapp_example_service.py ```</p>
<p>The content of <code>rapp_example_service.py</code> follows:</p>
<p>```python #!/usr/bin/env python</p>
<p>import rospy from add_two_integers import AddTwoIntegers from rapp_platform_ros_communications.srv import ( tutorialExampleServiceSrv, tutorialExampleServiceSrvRequest, tutorialExampleServiceSrvResponse)</p>
<p>class ExampleService: </p>
<pre class="fragment">def __init__(self):
    self.serv_topic = rospy.get_param("rapp_example_service_topic")
    if(not self.serv_topic):
        rospy.logerror("rapp_example_service_topic")
    self.serv=rospy.Service(self.serv_topic, tutorialExampleServiceSrv, self.tutorialExampleServiceDataHandler)

def tutorialExampleServiceDataHandler(self,req):
    res = tutorialExampleServiceSrvResponse()
    it = AddTwoIntegers()
    res=it.addTwoIntegersFunction(req)
    return res
</pre><p> ```</p>
<p>In this file, we initially declare python dependencies, one of them is the AddTwoIntegers class which we will define in a new file next. As you can see, we have imported an srv message files that needs to be created and declared in the rapp_platform_ros_communications package. We will cover this shortly. We also imported the name of the service from the .yaml file located in the cfg folder by the rospy.get_param() command. The return message of the service is handled by the DataHandler function we created, named tutorialExampleServiceDataHandler.</p>
<p>The last file we need to create is the <code>add_two_integers.py</code>.</p>
<p>```bash $ cd ~/rapp_platform/rapp-platform-catkin-ws/src/rapp-platform/rapp_example_service/src $ touch add_two_integers.py ```</p>
<p>The content of <code>add_two_integers.py</code> follows:</p>
<p>```python #!/usr/bin/env python</p>
<p>import rospy</p>
<p>from rapp_platform_ros_communications.srv import ( tutorialExampleServiceSrv, tutorialExampleServiceSrvRequest, tutorialExampleServiceSrvResponse)</p>
<p>class AddTwoIntegers: </p>
<pre class="fragment">def addTwoIntegersFunction(self,req):
    res = tutorialExampleServiceSrvResponse()
    res.additionResult=req.a+req.b
    return res
</pre><p> ```</p>
<p>In this file, initially we define the imports again and following we define the AddTwoIntegers class and within it a simple function named addTwoIntegersFunction that accepts the service requirements as input and returns the service response. We initially construct the response named res, and we assign to the addition value the addition of the parameters a and b.</p>
<h3>Create the service srv file</h3>
<p>The srv file defines what the service will accept as input and what it will return as output. These must be declared in a special file, called the service's srv file. RAPP Platform conveniently places all ROS service srv files, as well as ROS service message files in the </p>
<pre class="fragment">/rapp_platform/rapp-platform-catkin-ws/src/rapp-platform/rapp_platform_ros_communications/
</pre><p>package. Let us assume that the service we should to create takes as input two integer number, adds them together and returns the result. First we need to create the .srv file declaring the inputs and outputs of the service as shown:</p>
<p>```bash $ cd /rapp_platform/rapp-platform-catkin-ws/src/rapp-platform/rapp_platform_ros_communications/srv $ mkdir ExampleServices $ cd ExampleServices $ touch tutorialExampleServiceSrv.srv ```</p>
<p>The content of <code>tutorialExampleServiceSrv.srv</code> follows:</p>
<p>```yaml Header header int32 a </p>
<h2>int32 b </h2>
<p>int32 additionResult ```</p>
<p>Toe declare the .srv file in the package, open the <code>/rapp_platform/rapp-platform-catkin-ws/src/rapp-platform/rapp_platform_ros_communications/rapp_platform_ros_communications/CMakeLists.txt</code> file and add the following line within the <code>add_service_files()</code> block,</p>
<p>``` ExampleServices/tutorialExampleServiceSrv.srv ```</p>
<p>The whole file now should look like this:</p>
<p>```cmake cmake_minimum_required(VERSION 2.8.3) project(rapp_platform_ros_communications) set(ROS_BUILD_TYPE Release)</p>
<p>find_package(catkin REQUIRED COMPONENTS message_generation message_runtime std_msgs geometry_msgs nav_msgs )</p>
<h6></h6>
<h2>Declare ROS messages, services and actions</h2>
<h6></h6>
<h2>Generate messages in the 'msg' folder</h2>
<p>add_message_files( FILES StringArrayMsg.msg CognitiveExercisePerformanceRecordsMsg.msg MailMsg.msg NewsStoryMsg.msg WeatherForecastMsg.msg ArrayCognitiveExercisePerformanceRecordsMsg.msg CognitiveExercisesMsg.msg )</p>
<h2>Generate services in the 'srv' folder</h2>
<p>add_service_files( FILES</p>
<p>/ExampleServices/tutorialExampleServiceSrv.srv</p>
<p>/CognitiveExercise/testSelectorSrv.srv /CognitiveExercise/recordUserCognitiveTestPerformanceSrv.srv /CognitiveExercise/cognitiveTestCreatorSrv.srv /CognitiveExercise/userScoresForAllCategoriesSrv.srv /CognitiveExercise/userScoreHistoryForAllCategoriesSrv.srv /CognitiveExercise/returnTestsOfTypeSubtypeDifficultySrv.srv</p>
<p>/HumanDetection/HumanDetectionRosSrv.srv</p>
<p>/CaffeWrapper/imageClassificationSrv.srv /CaffeWrapper/ontologyClassBridgeSrv.srv /CaffeWrapper/registerImageToOntologySrv.srv</p>
<p>/DbWrapper/checkIfUserExistsSrv.srv /DbWrapper/getUserOntologyAliasSrv.srv /DbWrapper/getUserLanguageSrv.srv /DbWrapper/registerUserOntologyAliasSrv.srv /DbWrapper/getUserPasswordSrv.srv /DbWrapper/getUsernameAssociatedWithApplicationTokenSrv.srv /DbWrapper/createNewPlatformUserSrv.srv /DbWrapper/createNewApplicationTokenSrv.srv /DbWrapper/checkActiveApplicationTokenSrv.srv /DbWrapper/checkActiveRobotSessionSrv.srv /DbWrapper/addStoreTokenToDeviceSrv.srv /DbWrapper/validateUserRoleSrv.srv /DbWrapper/validateExistingPlatformDeviceTokenSrv.srv /DbWrapper/removePlatformUserSrv.srv /DbWrapper/createNewCloudAgentServiceSrv.srv /DbWrapper/createNewCloudAgentSrv.srv /DbWrapper/getCloudAgentServiceTypeAndHostPortSrv.srv</p>
<p>/OntologyWrapper/createInstanceSrv.srv /OntologyWrapper/ontologySubSuperClassesOfSrv.srv /OntologyWrapper/ontologyIsSubSuperClassOfSrv.srv /OntologyWrapper/ontologyLoadDumpSrv.srv /OntologyWrapper/ontologyInstancesOfSrv.srv /OntologyWrapper/assertRetractAttributeSrv.srv /OntologyWrapper/returnUserInstancesOfClassSrv.srv /OntologyWrapper/createOntologyAliasSrv.srv /OntologyWrapper/userPerformanceCognitveTestsSrv.srv /OntologyWrapper/createCognitiveExerciseTestSrv.srv /OntologyWrapper/cognitiveTestsOfTypeSrv.srv /OntologyWrapper/recordUserPerformanceCognitiveTestsSrv.srv /OntologyWrapper/clearUserPerformanceCognitveTestsSrv.srv /OntologyWrapper/registerImageObjectToOntologySrv.srv /OntologyWrapper/retractUserOntologyAliasSrv.srv</p>
<p>/FaceDetection/FaceDetectionRosSrv.srv</p>
<p>/NewsExplorer/NewsExplorerSrv.srv /Geolocator/GeolocatorSrv.srv</p>
<p>/WeatherReporter/WeatherReporterCurrentSrv.srv /WeatherReporter/WeatherReporterForecastSrv.srv</p>
<p>/QrDetection/QrDetectionRosSrv.srv</p>
<p>/Email/SendEmailSrv.srv /Email/ReceiveEmailSrv.srv</p>
<p>/SpeechDetectionGoogleWrapper/SpeechToTextSrv.srv</p>
<p>/SpeechDetectionSphinx4Wrapper/SpeechRecognitionSphinx4Srv.srv /SpeechDetectionSphinx4Wrapper/SpeechRecognitionSphinx4ConfigureSrv.srv /SpeechDetectionSphinx4Wrapper/SpeechRecognitionSphinx4TotalSrv.srv</p>
<p>/AudioProcessing/AudioProcessingDetectSilenceSrv.srv /AudioProcessing/AudioProcessingTransformAudioSrv.srv</p>
<p>/TextToSpeechEspeak/TextToSpeechSrv.srv</p>
<p>/HazardDetection/LightCheckRosSrv.srv /HazardDetection/DoorCheckRosSrv.srv</p>
<p>/PathPlanning/PathPlanningRosSrv.srv /Costmap2d/Costmap2dRosSrv.srv /PathPlanning/MapServer/MapServerGetMapRosSrv.srv /PathPlanning/MapServer/MapServerUploadMapRosSrv.srv</p>
<p>/ApplicationAuthentication/UserTokenAuthenticationSrv.srv /ApplicationAuthentication/UserLoginSrv.srv /ApplicationAuthentication/AddNewUserFromStoreSrv.srv /ApplicationAuthentication/AddNewUserFromPlatformSrv.srv )</p>
<h2>Generate added messages and services with any dependencies listed here</h2>
<p>generate_messages( DEPENDENCIES std_msgs # Or other packages containing msgs geometry_msgs nav_msgs )</p>
<h6></h6>
<h2>catkin specific configuration</h2>
<h6></h6>
<h2>The catkin_package macro generates cmake config files for your package</h2>
<h2>Declare things to be passed to dependent projects</h2>
<h2>INCLUDE_DIRS: uncomment this if you package contains header files</h2>
<h2>LIBRARIES: libraries you create in this project that dependent projects also need</h2>
<h2>CATKIN_DEPENDS: catkin_packages dependent projects also need</h2>
<h2>DEPENDS: system dependencies of this project that dependent projects also need</h2>
<p>catkin_package( </p>
<h1>INCLUDE_DIRS include</h1>
<h1>LIBRARIES rapp_platform_ros_communications</h1>
<h1>CATKIN_DEPENDS other_catkin_pkg</h1>
<p>CATKIN_DEPENDS message_generation message_runtime std_msgs geometry_msgs ) ```</p>
<p>This line will declare the srv file we created and stage it to be compiled.</p>
<p>Now we need to recompile the package. We will navigate to the root RAPP Platform catkin workspace directory and compile the code as shown below:</p>
<p>```bash $ cd ~/rapp_platform/rapp-platform-catkin-ws/ $ catkin_make &ndash;pkg rapp_platform_ros_communications ```</p>
<p>this will recompile only the specific package. Sometimes it is preferable to recompile the whole project, in that case please delete the folders build and devel and compile the whole project, as shown below:</p>
<p>```bash $ cd ~/rapp_platform/rapp-platform-catkin-ws/ $ rm -rf ./build ./devel $ catkin_make ```</p>
<h3>Launch and manually test the service</h3>
<p>In order to test that our ROS service works:</p>
<p>```bash $ cd ~/rapp_platform/rapp-platform-catkin-ws/ $ roslaunch rapp_example_service rapp_example_service.launch ```</p>
<p>With our service launched, use a different terminal and type:</p>
<p>```bash $ rosservice call /rapp/rapp_example_service/add_two_integers ```</p>
<p>and immediately press tab twice in order to auto complete the service requirements. Please assign values on the parameters a and b and hit enter. Voila! You can see the result in the additionResult parameter.</p>
<h2>Section 2: Create the HOP web service</h2>
<p>Read on <a href="https://github.com/rapp-project/rapp-platform/wiki/How-to-create-a-HOP-service-for-a-ROS-service%3F">How-to-create-a-HOP-service-for-a-ROS-service</a>, if you have not done so already.</p>
<p>Head to the <code>rapp_web_services</code> directory of the <code>rapp-platform</code> and create the source file for the Web Service implementation:</p>
<p>```bash $ cd ~/rapp_platform/rapp-platform-catkin-ws/src/rapp-platform/rapp_web_services/services $ mkdir example_web_service $ cd rapp_example_web_service $ touch svc.js ```</p>
<p>Open the <b>svc.js</b> file with your favorite editor and implement the <b>client-response</b> and <b>ros-msg</b> objects. The Web-Service response message inlcude the <code>sum_result</code> and <code>error</code> properties. The ROS Service request message has two integer properties, <code>a</code> and <code>b</code></p>
<p>```js var clientRes = function(sum_result, error) { sum_result = sum_result || 0; error = error || ''; return { sum_result: sum_result, error: error } }</p>
<p>var rosReqMsg = function(a, b) { a = a || 0; b = b || 0; return { a: a, b: b } } ```</p>
<p>The rapp_example_service ROS Service url path is <code>/rapp/rapp_example_service/add_two_integers</code></p>
<p>```js var rosSrvUrlPath = "/rapp/rapp_example_service/add_two_integers" ```</p>
<p>Next you need to implement the WebService <b>onrequest</b> callback function. This is the function that will be called as long as a request for the rapp_example_web_service arrives.</p>
<p>```js function svcImpl(req, resp, ros) { // Get values of 'a' and 'b' from request body. var numA = req.body.a; var numB = req.body.b;</p>
<p>// Create the rosMsg var rosMsg = new rosReqMsg(numA, numB);</p>
<p>/***</p>
<ul>
<li>ROS-Service response callback.</li>
</ul>
<p>function callback(rosResponse){ // Get the sum result value from ROS Service response message. var response = clientRes( rosResponse.additionResult ); // Return the sum result, of numbers 'a' and 'b', to the client. resp.sendJson(response); }</p>
<p>/***</p>
<ul>
<li>ROS-Service onerror callback.</li>
</ul>
<p>function onerror(e){ // Respond a "Server Error". HTTP Error 501 - Internal Server Error resp.sendServerError(); }</p>
<p>/***</p>
<ul>
<li>Call ROS-Service.</li>
</ul>
<p>ros.callService(rosSrvUrlPath, rosMsg, {success: callback, fail: onerror}); } ```</p>
<p>Export the service onrequest callback function (svcImpl):</p>
<p>```js module.exports = svcImpl; ```</p>
<p>Add the <code>rapp_example_web_service</code> entry in <a href="https://github.com/rapp-project/rapp-platform/blob/master/rapp_web_services/config/services/services.json">services.json</a> file:</p>
<p>```json "rapp_example_web_service": { "launch": true, "anonymous": false, "name": "rapp_example_web_service", "url_name": "add_two_ints", "namespace": "", "ros_connection": true, "timeout": 45000 } ```</p>
<p>The Web Service will listen at <code><a href="http://localhost:9001/hop/add_two_ints">http://localhost:9001/hop/add_two_ints</a></code> as defined by the <code>url_name</code> value.</p>
<p>You can set the url path for the Web Service to be <code>rapp_example_web_service/add_two_ints</code> by setting the url_name and namespace respectively:</p>
<p>```json "rapp_example_web_service": { "launch": true, "anonymous": false, "name": "rapp_example_web_service", "url_name": "add_two_ints", "namespace": "rapp_example_web_service", "ros_connection": true, "timeout": 45000 } ```</p>
<p>We have also set this Web Service to timeout after 45 seconds (<code>timeout</code>). This is critical when WebService-to-ROS communcation bridge breaks!</p>
<p>For simplicity, we will configure this WebService to be launched under an already existed Web Worker thread (<b>main-1</b>).</p>
<p>The <a href="https://github.com/rapp-project/rapp-platform/blob/master/rapp_web_services/config/services/workers.json">workers.json</a> file contains Web Workers entries. Add the <code>rapp_example_web_service</code> service under the <code>main-1</code> worker:</p>
<p>```json "main-1": { "launch": true, "path": "workers/main1.js", "services": [ ... "rapp_example_web_service" ] } ```</p>
<p>The newly implemented <code>rapp_example_web_service</code> Web Service is ready to be launched. Launch the RAPP Platform Web Server:</p>
<p>```bash $ cd ~/rapp_platform/rapp-platform-catkin-ws/src/rapp-platform/rapp_web_services $ pm2 start server.yaml ```</p>
<p>If you dont want to launch the Web Server using pm2 process manager, just execute the <code>run.sh</code> script in the same directory:</p>
<p>```bash $ ./run.sh ```</p>
<p>You will notice the following output from the logs:</p>
<p>```bash info: [] Registered worker service {<a href="http://localhost:9001/hop/add_two_ints">http://localhost:9001/hop/add_two_ints</a>} under worker thread {main-1} info: [] { worker: 'main-1', path: '/hop/add_two_ints', url: '<a href="http://localhost:9001/hop/add_two_ints',">http://localhost:9001/hop/add_two_ints',</a> frame: [Function] } ```</p>
<p>All set! The RAPP Platform accepts requests for the <code>rapp_example_web_service</code> at <code><a href="http://rapp-platform-local:9001/hop/add_two_ints">http://rapp-platform-local:9001/hop/add_two_ints</a></code></p>
<p>You can test it using <code>curl</code> from commandline:</p>
<p>```bash $ curl &ndash;data "a=100&amp;b=20" <a href="http://localhost:9001/hop/add_two_ints">http://localhost:9001/hop/add_two_ints</a> ```</p>
<p>Notice that the RAPP Platform will return <code>Authentication Failure</code> (HTTP 401 Unauthorized Error). This is because the RAPP Platform uses token-based application authentication mechanisms to authenticate incoming client requests. You will have to pass a valid token to the <b>request headers</b>. By default, the RAPP Platform database includes a user <code>rapp</code> and the token is <b>rapp_token</b>. Pass that token value to the <code>Accept-Token</code> field of the request header:</p>
<p>```bash $ curl -H "Accept-Token: rapp_token" &ndash;data "a=100&amp;b=20" <a href="http://localhost:9001/hop/add_two_ints">http://localhost:9001/hop/add_two_ints</a> ```</p>
<p>The output should now be:</p>
<p>```bash {sum_result: 120, error: ''} ```</p>
<h2>Section 3: Update the RAPP Platform API</h2>
<p>First, read on <a href="https://github.com/rapp-project/rapp-platform/wiki/How-to-write-the-API-for-a-HOP-service%3F">How to write the API for a HOP service</a>, if you have not done so already.</p>
<p>Head to the <a href="https://github.com/rapp-project/rapp-api/tree/master/python/RappCloud/CloudMsgs">RappCloud/CloudMsgs</a> directory of the RappCloud module and create a file named <b>AddTwoInts.py</b></p>
<p>```bash $ cd ~/rapp_platform/rapp_platform_catkin_ws/src/rapp-api/python/RappCloud/CloudMsgs $ touch AddTwoInts.py ```</p>
<p>The contents of the <b>AddTwoInts.py</b> source file should be:</p>
<p>```python from RappCloud.Objects import ( File, Payload)</p>
<p>from Cloud import ( CloudMsg, CloudRequest, CloudResponse)</p>
<p>class AddTwoInts(CloudMsg): """ Add Two Integers Exqample CloudMsg object"""</p>
<p>class Request(CloudRequest): """ Add Two Integers Cloud Request object. AddTwoInts.Request """ def <b>init</b>(self, **kwargs): """! Constructor </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">**kwargs</td><td>- Keyword arguments. Apply values to the request attributes.<ul>
<li>a</li>
<li>b"</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<h2>Number #1</h2>
<p>self.a = 0 </p>
<h2>Number #2</h2>
<p>self.b = 0 </p>
<h1>Apply passed keyword arguments to the Request object.</h1>
<p>super(AddTwoInts.Request, self).__init__(**kwargs)</p>
<pre class="fragment">    def make_payload(self):
        """ Create and return the Payload of the Request. """
        return Payload(a=self.a, b=self.b)

    def make_files(self):
        """ Create and return Array of File objects of the Request. """
        return []

    class Response(CloudResponse):
        """ Add Two Integers Cloud Response object. AddTwoInts.Response """
        def __init__(self, **kwargs):
            """!
            Constructor

            @param **kwargs - Keyword arguments. Apply values to the request attributes.
            - @ref error
            - @ref sum_result
            """
            ## Error message
            self.error = ''
            ## The sum result of numbers a and b
            self.sum_result = 0
            ## Apply passed keyword arguments to the Request object.
            super(AddTwoInts.Response, self).__init__(**kwargs)


    def __init__(self, **kwargs):
        """!
        Constructor

        @param **kwargs - Keyword arguments. Apply values to the request attributes.
            - @ref Request.a
            - @ref Request.b
        """

        # Create and hold the Request object for this CloudMsg
        self.req = AddTwoInts.Request()
        # Create and hold the Response object for this CloudMsg
        self.resp = AddTwoInts.Response()
        super(AddTwoInts, self).__init__(svcname='add_two_ints', **kwargs)
</pre><p>```</p>
<p>Finally append the following line of code in the <code>RappCloud/CloudMsgs/__init__.py</code> file:</p>
<p>```python from AddTwoInts import AddTwoInts ```</p>
<p>Now everything is in place to call the newly created RAPP Platform Service, using the python implementation of the rapp-platform-api. An example is presented below:</p>
<p>```python from RappCloud.CloudMsgs import AddTwoInts from RappCloud import RappPlatformService</p>
<p>svcClient = RappPlatformService(persistent=True, timeout=1000) msg = AddTwoInts(a=5, b=4)</p>
<p>response svcClient.call(msg)</p>
<p>print response.sum_result </p>
<blockquote class="doxtable">
<blockquote class="doxtable">
<p>9</p>
<p></p>
</blockquote>
<p></p>
</blockquote>
<p>``` </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Jul 29 2016 18:44:08 for RAPP Platform Wiki by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
