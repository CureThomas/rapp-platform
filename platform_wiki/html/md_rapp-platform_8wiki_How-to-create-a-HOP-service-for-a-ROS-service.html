<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>RAPP Platform Wiki: ? How-to-create-a-HOP-service-for-a-ROS-service?</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="RAPP_logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">RAPP Platform Wiki
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md_rapp-platform_8wiki_How-to-create-a-HOP-service-for-a-ROS-service.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">? How-to-create-a-HOP-service-for-a-ROS-service? </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Currently, there does not exist a tool to automate generation of web_services. Developers must be familiar with developing server-side applications using Nodejs and have a minor knowledge on developing Web-Services using the HOP Framework.</p>
<p>While developing RAPP Platform Web Services, you might want to read on <a href="https://github.com/manuel-serrano/hop">HOP/hopjs</a>.</p>
<p>If you are not familiar with server-side applications, you might also have to read on <a href="https://nodejs.org/en/">Nodejs</a>.</p>
<h2>Hop.js made simple - Overview</h2>
<p>Hop.js is a multitier extension of JavaScript. It allows a single JavaScript program to describe the client-side and the server-side components of a Web application. Its runtime environment ensures a consistent execution of the application on the server and on the client.</p>
<p>HopScript is based on JavaScript and aims at ensuring compatibility with this language</p>
<ul>
<li>HopScript fully supports ECMAScript 5</li>
<li>HopScript also support some ECMAScript 6 features:<ul>
<li>arrow functions.</li>
<li>default function parameters.</li>
<li>rest arguments.</li>
<li>let and const bindings.</li>
<li>symbols.</li>
<li>template strings.</li>
<li>promises.</li>
<li>typed Arrays.</li>
</ul>
</li>
<li>HopScript supports most Nodejs APIs (see Section Nodejs)</li>
</ul>
<p>Hop programs execute in the context of a builtin web server. They define services, which are super JavaScript functions that get automatically invoked when HTTP requests are received. Functions and services are almost syntactically similar but the latter are defined using the service keyword:</p>
<p>```javascript service hello() { return "hello world"; } ```</p>
<p>To run this program put this code in the file hello.js and execute:</p>
<p>```shell $ hop -p 8080 hello.js ```</p>
<p>Hop extends JavaScript with the geniune HTML. if we want to modify our service to make it return an HTML document, we can use:</p>
<p>```javascript service hello() { return &lt;html&gt;</p>
<div>hello world</div><p>&lt;/html&gt;; } ```</p>
<p>Hop is multitier. That is client-side codes are also implemented in Hop. The ~{ mark switches from server-side context to client-side context:</p>
<p>```javascript service hello() { return &lt;html&gt;&lt;div onclick=~{ alert( "world" ) }&gt;hello&lt;/html&gt;; } ```</p>
<p>Hop client-side code and server-side can also be mixed using the ${ mark:</p>
<p>```javascript service hello( { who: "foo" } ) { return &lt;html&gt;&lt;div onclick=~{ alert( "Hi " + ${who} + "!") }&gt;hello&lt;/html&gt;; } ```</p>
<h2>Integration with the ROS Framework</h2>
<p>In most cases a HOP Web Service must be able to "**Talk ROS**", meaning that a stable interface between the two, HOP Web Service and ROS, must exist.</p>
<p>For the RAPP Platform requirements, we use the lightweight, <a href="https://github.com/klpanagi/RosBridgeJS">RosBridgeJS</a> module. This module has been developed under the RAPP Project to provide to HOP Services developers, an <b>easy-to-use</b> intermediate transport interface layer for calling ROS-Services through their hopjs applications. It integrates a websocket client that allows connections to <a href="http://wiki.ros.org/rosbridge_server">rosbridge-websocket-server</a> and a service controller to call ROS-Service(s).</p>
<p>Initiate rosbridgejs:</p>
<p>```javascript /***</p>
<ul>
<li>Import the RosBridgeJS module.</li>
</ul>
<p>var Rosbridge = require( '&lt;path_to_RosBridgeJs_sources&gt;/RosBridgeJS.js' );</p>
<p>/***</p>
<ul>
<li>Initiate connection to rosbridge_websocket_server.</li>
<li></li>
<li>By default, it tries to connect to ws://localhost:9090.</li>
<li>This is the default URL the rosbridge-websocket-server listens to.</li>
</ul>
<p>var ros = new ROS({hostname: '', port: '', reconnect: true, onconnection: function(){ // . } });</p>
<p>```</p>
<p>Fill request parameters for the ROS-Service:</p>
<p>```javascript /***</p>
<ul>
<li>Fill Ros Service request msg parameters here.</li>
<li>var args = {param1: '', param2: ''};</li>
<li>var args = { imageFilename: 'face_image_frame.png' }; ```</li>
</ul>
<p>Declare/Implement the callback functions:</p>
<p>```javascript </p>
<pre class="fragment">  /***
   * Declare the ROS-Service response callback here!!
   * This callback function will be passed into the rosbridge service
   * controller and will be called when a response from rosbridge
   * websocket server arrives.

  function callback(data){
     console.log(data);
  }

  /***
   * Declare the onerror callback.
   * The onerror callack function will be called by the service
   * controller as soon as an error occures, on service request.
   *

  function onerror(e){
    console.log(e);
  }
</pre><p>```</p>
<p>Call the ROS-Service (/rapp/rapp_face_detection/detect_faces):</p>
<p>```javascript </p>
<pre class="fragment"> var rosSrvName = '/rapp/rapp_face_detection/detect_faces';

  /***
   * Call ROS-Service.
   * Input arguments:
   *   - rosSrvName: The name of the ROS-Service to call&lt;/li&gt;
   *   - args: ROS-Service request message arguments&lt;/li&gt;
   *   - objLiteral: An object literal to declare the onsuccess and
   *        onerror callbacks.
   *      { success: &lt;onsuccess_callback&gt;,fail: &lt;onerror_callback&gt; }
   *

  ros.callService(rosSrvName, args,
    {success: callback, fail: onerror});
</pre><p> ```</p>
<h2>Use the provided by us, HOP Service Creation Templates:</h2>
<p>To make development of HOP Web Services more attractive and understandable, we provide two template source files:</p>
<ul>
<li><a href="https://github.com/rapp-project/rapp-platform/tree/master/rapp_web_services/services/templates/web_service.template.js">web_service.template.js</a></li>
<li><a href="https://github.com/rapp-project/rapp-platform/blob/master/rapp_web_services/services/templates/web_service_post_file.template.js">web_services_post_file.template.js</a></li>
</ul>
<p>Using these templates as a reference while developing HOP Web Services for a ROS-Service, might save you alot of hours studying! In most cases, you might have to change just a few lines of code!</p>
<p>For more information read <a href="https://github.com/rapp-project/rapp-platform/tree/master/rapp_web_services/services/templates">here</a>.</p>
<h2>Where to store HOP Service source files and how to register the service under the HOP Server.</h2>
<p>HOP Service source files are stored under the <b>services/</b> directory, of the rapp_web_services package.</p>
<p>Any **.js** file, stored under this directory with a **.service.js** extension, is considered to be a HOP Web Service source file.</p>
<p>HOP Server is responsible for registering those services, on run-time, as workers, so you will never have to write code to register your HOP Web Service. Just store the source file under the aforementioned directory with a **.service.js** extension. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Dec 7 2015 10:13:56 for RAPP Platform Wiki by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
